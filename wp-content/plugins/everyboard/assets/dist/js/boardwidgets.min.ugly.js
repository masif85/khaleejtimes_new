!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){function t(t,e){this.items=t,this.settings=e||{diacritics:!0}}t.prototype.tokenize=function(t){if(!(t=a(String(t||"").toLowerCase()))||!t.length)return[];for(var e,i,n=[],o=t.split(/ +/),r=0,s=o.length;r<s;r++){if(e=l(o[r]),this.settings.diacritics)for(i in d)d.hasOwnProperty(i)&&(e=e.replace(new RegExp(i,"g"),d[i]));n.push({string:o[r],regex:new RegExp(e,"i")})}return n},t.prototype.iterator=function(t,e){(s(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])},t.prototype.getScoreFunction=function(t,e){function o(t,e){var i;return t?-1===(i=(t=String(t||"")).search(e.regex))?0:(t=e.string.length/t.length,0===i&&(t+=.5),t):0}var r,s=(t=this.prepareSearch(t,e)).tokens,a=t.options.fields,l=s.length,d=t.options.nesting,p=(r=a.length)?1===r?function(t,e){return o(g(e,a[0],d),t)}:function(t,e){for(var i=0,n=0;i<r;i++)n+=o(g(e,a[i],d),t);return n/r}:function(){return 0};return l?1===l?function(t){return p(s[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,n=0;i<l;i++){if((e=p(s[i],t))<=0)return 0;n+=e}return n/l}:function(t){for(var e=0,i=0;e<l;e++)i+=p(s[e],t);return i/l}:function(){return 0}},t.prototype.getSortFunction=function(t,i){var e,n,o,r,s,a,l,d=this,p=!(t=d.prepareSearch(t,i)).query&&i.sort_empty||i.sort,c=function(t,e){return"$score"===t?e.score:g(d.items[e.id],t,i.nesting)},u=[];if(p)for(e=0,n=p.length;e<n;e++)!t.query&&"$score"===p[e].field||u.push(p[e]);if(t.query){for(l=!0,e=0,n=u.length;e<n;e++)if("$score"===u[e].field){l=!1;break}l&&u.unshift({field:"$score",direction:"desc"})}else for(e=0,n=u.length;e<n;e++)if("$score"===u[e].field){u.splice(e,1);break}for(a=[],e=0,n=u.length;e<n;e++)a.push("desc"===u[e].direction?-1:1);return(r=u.length)?1===r?(o=u[0].field,s=a[0],function(t,e){return s*h(c(o,t),c(o,e))}):function(t,e){for(var i,n=0;n<r;n++)if(i=u[n].field,i=a[n]*h(c(i,t),c(i,e)))return i;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;var i=(e=r({},e)).fields,n=e.sort,o=e.sort_empty;return i&&!s(i)&&(e.fields=[i]),n&&!s(n)&&(e.sort=[n]),o&&!s(o)&&(e.sort_empty=[o]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,i){var n,o,e=this,r=this.prepareSearch(t,i);return i=r.options,t=r.query,o=i.score||e.getScoreFunction(r),t.length?e.iterator(e.items,function(t,e){n=o(t),(!1===i.filter||0<n)&&r.items.push({score:n,id:e})}):e.iterator(e.items,function(t,e){r.items.push({score:1,id:e})}),(e=e.getSortFunction(r,i))&&r.items.sort(e),r.total=r.items.length,"number"==typeof i.limit&&(r.items=r.items.slice(0,i.limit)),r};var h=function(t,e){return"number"==typeof t&&"number"==typeof e||(t=i(String(t||"")),e=i(String(e||""))),e<t?1:t<e?-1:0},r=function(t,e){for(var i,n,o=1,r=arguments.length;o<r;o++)if(n=arguments[o])for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},g=function(t,e,i){if(t&&e){if(!i)return t[e];for(var n=e.split(".");n.length&&(t=t[n.shift()]););return t}},a=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},l=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||"undefined"!=typeof $&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},d={a:"[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]",b:"[b␢βΒB฿𐌁ᛒ]",c:"[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]",d:"[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]",e:"[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]",f:"[fƑƒḞḟ]",g:"[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]",h:"[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]",i:"[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]",j:"[jȷĴĵɈɉʝɟʲ]",k:"[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]",l:"[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]",n:"[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]",o:"[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]",p:"[pṔṕṖṗⱣᵽƤƥᵱ]",q:"[qꝖꝗʠɊɋꝘꝙq̃]",r:"[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]",s:"[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]",t:"[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]",u:"[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]",v:"[vṼṽṾṿƲʋꝞꝟⱱʋ]",w:"[wẂẃẀẁŴŵẄẅẆẇẈẉ]",x:"[xẌẍẊẋχ]",y:"[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]",z:"[zŹźẐẑŽžŻżẒẓẔẕƵƶ]"},i=function(){var t,e,i,n,o="",r={};for(i in d)if(d.hasOwnProperty(i))for(n=d[i].substring(2,d[i].length-1),o+=n,t=0,e=n.length;t<e;t++)r[n.charAt(t)]=i;var s=new RegExp("["+o+"]","g");return function(t){return t.replace(s,function(t){return r[t]}).toLowerCase()}}();return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={mixin:function(n){n.plugins={},n.prototype.initializePlugins=function(t){var e,i,n,o=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},r.isArray(t))for(e=0,i=t.length;e<i;e++)"string"==typeof t[e]?o.push(t[e]):(this.plugins.settings[t[e].name]=t[e].options,o.push(t[e].name));else if(t)for(n in t)t.hasOwnProperty(n)&&(this.plugins.settings[n]=t[n],o.push(n));for(;o.length;)this.require(o.shift())},n.prototype.loadPlugin=function(t){var e=this.plugins,i=n.plugins[t];if(!n.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');e.requested[t]=!0,e.loaded[t]=i.fn.apply(this,[this.plugins.settings[t]||{}]),e.names.push(t)},n.prototype.require=function(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]},n.define=function(t,e){n.plugins[t]={name:t,fn:e}}}},r={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function($,p,t){"use strict";jQuery.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()}).end()};function n(){}n.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=0)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["on","off","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]};function l(t){return void 0!==t}function _(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""}function a(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function i(e,i,t){var n,o=e.trigger,r={};for(n in e.trigger=function(){var t=arguments[0];return-1===i.indexOf(t)?o.apply(e,arguments):void(r[t]=arguments)},t.apply(e,[]),e.trigger=o,r)r.hasOwnProperty(n)&&o.apply(e,r[n])}function d(t){var e,i,n={};return"selectionStart"in t?(n.start=t.selectionStart,n.length=t.selectionEnd-n.start):document.selection&&(t.focus(),e=document.selection.createRange(),i=document.selection.createRange().text.length,e.moveStart("character",-t.value.length),n.start=e.text.length-i,n.length=i),n}function c(t,e){return t?(t=$("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body"),function(t,e,i){var n,o,r={};if(i)for(n=0,o=i.length;n<o;n++)r[i[n]]=t.css(i[n]);else r=t.css();e.css(r)}(e,t,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),e=t.width(),t.remove(),e):0}function v(s){function t(t,e){var i,n,o,r;e=e||{},(t=t||window.event||{}).metaKey||t.altKey||!e.force&&!1===s.data("grow")||(n=s.val(),t.type&&"keydown"===t.type.toLowerCase()&&(o=97<=(i=t.keyCode)&&i<=122||65<=i&&i<=90||48<=i&&i<=57||32===i,46===i||8===i?(e=d(s[0])).length?n=n.substring(0,e.start)+n.substring(e.start+e.length):8===i&&e.start?n=n.substring(0,e.start-1)+n.substring(e.start+1):46===i&&void 0!==e.start&&(n=n.substring(0,e.start)+n.substring(e.start+1)):o&&(o=t.shiftKey,r=String.fromCharCode(t.keyCode),n+=r=o?r.toUpperCase():r.toLowerCase())),r=s.attr("placeholder"),(n=c(n=!n&&r?r:n,s)+4)!==a&&(a=n,s.width(n),s.triggerHandler("resize")))}var a=null;s.on("keydown keyup update blur",t),t()}var m=/Mac/.test(navigator.userAgent),y=m?91:17,w=m?18:17,C=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,e={before:function(t,e,i){var n=t[e];t[e]=function(){return i.apply(t,arguments),n.apply(t,arguments)}},after:function(e,t,i){var n=e[t];e[t]=function(){var t=n.apply(e,arguments);return i.apply(e,arguments),t}}},O=function(t,e){var i,n,o=this,r=t[0];r.selectize=o;var s,a,l,d=window.getComputedStyle&&window.getComputedStyle(r,null);if(d=(d=d?d.getPropertyValue("direction"):r.currentStyle&&r.currentStyle.direction)||t.parents("[dir]:first").attr("dir")||"",$.extend(o,{order:0,settings:e,$input:t,tabIndex:t.attr("tabindex")||"",tagType:"select"===r.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(d),eventNS:".selectize"+ ++O.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:t.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===e.loadThrottle?o.onSearchChange:(s=o.onSearchChange,a=e.loadThrottle,function(){var t=this,e=arguments;window.clearTimeout(l),l=window.setTimeout(function(){s.apply(t,e)},a)})}),o.sifter=new p(this.options,{diacritics:e.diacritics}),o.settings.options){for(i=0,n=o.settings.options.length;i<n;i++)o.registerOption(o.settings.options[i]);delete o.settings.options}if(o.settings.optgroups){for(i=0,n=o.settings.optgroups.length;i<n;i++)o.registerOptionGroup(o.settings.optgroups[i]);delete o.settings.optgroups}o.settings.mode=o.settings.mode||(1===o.settings.maxItems?"single":"multi"),"boolean"!=typeof o.settings.hideSelected&&(o.settings.hideSelected="multi"===o.settings.mode),o.initializePlugins(o.settings.plugins),o.setupCallbacks(),o.setupTemplates(),o.setup()};return n.mixin(O),void 0!==t?t.mixin(O):function(t,e){e=e||{};console.error("Selectize: "+t),e.explanation&&(console.group&&console.group(),console.error(e.explanation),console.group&&console.groupEnd())}("Dependency MicroPlugin is missing",{explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'}),$.extend(O.prototype,{setup:function(){var t,i,n,e=this,o=e.settings,r=e.eventNS,s=$(window),a=$(document),l=e.$input,d=e.settings.mode,p=l.attr("class")||"",c=$("<div>").addClass(o.wrapperClass).addClass(p).addClass(d),u=$("<div>").addClass(o.inputClass).addClass("items").appendTo(c),h=$('<input type="text" autocomplete="off" />').appendTo(u).attr("tabindex",l.is(":disabled")?"-1":e.tabIndex),g=$(o.dropdownParent||c),f=$("<div>").addClass(o.dropdownClass).addClass(d).hide().appendTo(g),d=$("<div>").addClass(o.dropdownContentClass).appendTo(f);(g=l.attr("id"))&&(h.attr("id",g+"-selectized"),$("label[for='"+g+"']").attr("for",g+"-selectized")),e.settings.copyClassesToDropdown&&f.addClass(p),c.css({width:l[0].style.width}),e.plugins.names.length&&(t="plugin-"+e.plugins.names.join(" plugin-"),c.addClass(t),f.addClass(t)),(null===o.maxItems||1<o.maxItems)&&1===e.tagType&&l.attr("multiple","multiple"),e.settings.placeholder&&h.attr("placeholder",o.placeholder),!e.settings.splitOn&&e.settings.delimiter&&(t=e.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),e.settings.splitOn=new RegExp("\\s*"+t+"+\\s*")),l.attr("autocorrect")&&h.attr("autocorrect",l.attr("autocorrect")),l.attr("autocapitalize")&&h.attr("autocapitalize",l.attr("autocapitalize")),e.$wrapper=c,e.$control=u,e.$control_input=h,e.$dropdown=f,e.$dropdown_content=d,f.on("mouseenter","[data-selectable]",function(){return e.onOptionHover.apply(e,arguments)}),f.on("mousedown click","[data-selectable]",function(){return e.onOptionSelect.apply(e,arguments)}),d="mousedown",f="*:not(input)",n=function(){return e.onItemSelect.apply(e,arguments)},(i=u).on(d,f,function(t){for(var e=t.target;e&&e.parentNode!==i[0];)e=e.parentNode;return t.currentTarget=e,n.apply(this,[t])}),v(h),u.on({mousedown:function(){return e.onMouseDown.apply(e,arguments)},click:function(){return e.onClick.apply(e,arguments)}}),h.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return e.onKeyDown.apply(e,arguments)},keyup:function(){return e.onKeyUp.apply(e,arguments)},keypress:function(){return e.onKeyPress.apply(e,arguments)},resize:function(){e.positionDropdown.apply(e,[])},blur:function(){return e.onBlur.apply(e,arguments)},focus:function(){return e.ignoreBlur=!1,e.onFocus.apply(e,arguments)},paste:function(){return e.onPaste.apply(e,arguments)}}),a.on("keydown"+r,function(t){e.isCmdDown=t[m?"metaKey":"ctrlKey"],e.isCtrlDown=t[m?"altKey":"ctrlKey"],e.isShiftDown=t.shiftKey}),a.on("keyup"+r,function(t){t.keyCode===w&&(e.isCtrlDown=!1),16===t.keyCode&&(e.isShiftDown=!1),t.keyCode===y&&(e.isCmdDown=!1)}),a.on("mousedown"+r,function(t){if(e.isFocused){if(t.target===e.$dropdown[0]||t.target.parentNode===e.$dropdown[0])return!1;e.$control.has(t.target).length||t.target===e.$control[0]||e.blur(t.target)}}),s.on(["scroll"+r,"resize"+r].join(" "),function(){e.isOpen&&e.positionDropdown.apply(e,arguments)}),s.on("mousemove"+r,function(){e.ignoreHover=!1}),this.revertSettings={$children:l.children().detach(),tabindex:l.attr("tabindex")},l.attr("tabindex",-1).hide().after(e.$wrapper),$.isArray(o.items)&&(e.setValue(o.items),delete o.items),C&&l.on("invalid"+r,function(t){t.preventDefault(),e.isInvalid=!0,e.refreshState()}),e.updateOriginalInput(),e.refreshItems(),e.refreshState(),e.updatePlaceholder(),e.isSetup=!0,l.is(":disabled")&&e.disable(),e.on("change",this.onChange),l.data("selectize",e),l.addClass("selectized"),e.trigger("initialize"),!0===o.preload&&e.onSearchChange("")},setupTemplates:function(){var i=this.settings.labelField,n=this.settings.optgroupLabelField,t={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[n])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[i])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[i])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=$.extend({},t,this.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]],e&&this.on(t,e))},onClick:function(t){this.isFocused||(this.focus(),t.preventDefault())},onMouseDown:function(t){var e=this,i=t.isDefaultPrevented();if($(t.target),e.isFocused){if(t.target!==e.$control_input[0])return"single"===e.settings.mode?e.isOpen?e.close():e.open():i||e.setActiveItem(null),!1}else i||window.setTimeout(function(){e.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var o=this;return o.isFull()||o.isInputHidden||o.isLocked?void t.preventDefault():void(o.settings.splitOn&&setTimeout(function(){var t=o.$control_input.val();if(t.match(o.settings.splitOn))for(var e=$.trim(t).split(o.settings.splitOn),i=0,n=e.length;i<n;i++)o.createItem(e[i])},0))},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e,i=(t.target,this.$control_input[0],this);if(!i.isLocked){switch(t.keyCode){case 65:if(i.isCmdDown)return void i.selectAll();break;case 27:return void(i.isOpen&&(t.preventDefault(),t.stopPropagation(),i.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:return!i.isOpen&&i.hasOptions?i.open():i.$activeOption&&(i.ignoreHover=!0,(e=i.getAdjacentOption(i.$activeOption,1)).length&&i.setActiveOption(e,!0,!0)),void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:return i.$activeOption&&(i.ignoreHover=!0,(e=i.getAdjacentOption(i.$activeOption,-1)).length&&i.setActiveOption(e,!0,!0)),void t.preventDefault();case 13:return void(i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),t.preventDefault()));case 37:return void i.advanceSelection(-1,t);case 39:return void i.advanceSelection(1,t);case 9:return i.settings.selectOnTab&&i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),i.isFull()||t.preventDefault()),void(i.settings.create&&i.createItem()&&t.preventDefault());case 8:case 46:return void i.deleteSelection(t)}return!i.isFull()&&!i.isInputHidden||(m?t.metaKey:t.ctrlKey)?void 0:void t.preventDefault()}9!==t.keyCode&&t.preventDefault()},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();t=e.$control_input.val()||"";e.lastValue!==t&&(e.lastValue=t,e.onSearchChange(t),e.refreshOptions(),e.trigger("type",t))},onSearchChange:function(e){var i=this,n=i.settings.load;n&&(i.loadedSearches.hasOwnProperty(e)||(i.loadedSearches[e]=!0,i.load(function(t){n.apply(i,[e,t])})))},onFocus:function(t){var e=this,i=e.isFocused;return e.isDisabled?(e.blur(),t&&t.preventDefault(),!1):void(e.ignoreFocus||(e.isFocused=!0,"focus"===e.settings.preload&&e.onSearchChange(""),i||e.trigger("focus"),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState()))},onBlur:function(t,e){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(t);t=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),e&&e.focus(),i.ignoreFocus=!1,i.trigger("blur")};i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,t):t()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(t){var e,i=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),(e=$(t.currentTarget)).hasClass("create")?i.createItem(null,function(){i.settings.closeAfterSelect&&i.close()}):void 0!==(e=e.attr("data-value"))&&(i.lastQuery=null,i.setTextboxValue(""),i.addItem(e),i.settings.closeAfterSelect?i.close():!i.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&i.setActiveOption(i.getOption(e)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){i(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},setActiveItem:function(t,e){var i,n,o,r,s,a,l=this;if("single"!==l.settings.mode){if(!(t=$(t)).length)return $(l.$activeItems).removeClass("active"),l.$activeItems=[],void(l.isFocused&&l.showInput());if("mousedown"===(n=e&&e.type.toLowerCase())&&l.isShiftDown&&l.$activeItems.length){for(a=l.$control.children(".active:last"),o=Array.prototype.indexOf.apply(l.$control[0].childNodes,[a[0]]),(r=Array.prototype.indexOf.apply(l.$control[0].childNodes,[t[0]]))<o&&(a=o,o=r,r=a),i=o;i<=r;i++)s=l.$control[0].childNodes[i],-1===l.$activeItems.indexOf(s)&&($(s).addClass("active"),l.$activeItems.push(s));e.preventDefault()}else"mousedown"===n&&l.isCtrlDown||"keydown"===n&&this.isShiftDown?t.hasClass("active")?(n=l.$activeItems.indexOf(t[0]),l.$activeItems.splice(n,1),t.removeClass("active")):l.$activeItems.push(t.addClass("active")[0]):($(l.$activeItems).removeClass("active"),l.$activeItems=[t.addClass("active")[0]]);l.hideInput(),this.isFocused||l.focus()}},setActiveOption:function(t,e,i){var n,o,r,s,a=this;a.$activeOption&&a.$activeOption.removeClass("active"),a.$activeOption=null,(t=$(t)).length&&(a.$activeOption=t.addClass("active"),!e&&l(e)||(n=a.$dropdown_content.height(),o=a.$activeOption.outerHeight(!0),e=a.$dropdown_content.scrollTop()||0,t=(s=r=a.$activeOption.offset().top-a.$dropdown_content.offset().top+e)-n+o,n+e<r+o?a.$dropdown_content.stop().animate({scrollTop:t},i?a.settings.scrollDuration:0):r<e&&a.$dropdown_content.stop().animate({scrollTop:s},i?a.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(t){var e,i,n,o=this,r=o.settings,s=this.getSearchOptions();if(r.score&&"function"!=typeof(n=o.settings.score.apply(this,[t])))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==o.lastQuery?(o.lastQuery=t,i=o.sifter.search(t,$.extend(s,{score:n})),o.currentResults=i):i=$.extend(!0,{},o.currentResults),r.hideSelected)for(e=i.items.length-1;0<=e;e--)-1!==o.items.indexOf(_(i.items[e].id))&&i.items.splice(e,1);return i},refreshOptions:function(t){var e,i,n,o,r,s,a,l,d,p,c,u,h,g;void 0===t&&(t=!0);var f,v,m=this,y=$.trim(m.$control_input.val()),w=m.search(y),C=m.$dropdown_content,O=m.$activeOption&&_(m.$activeOption.attr("data-value")),b=w.items.length;for("number"==typeof m.settings.maxOptions&&(b=Math.min(b,m.settings.maxOptions)),o={},r=[],e=0;e<b;e++)for(s=m.options[w.items[e].id],a=m.render("option",s),l=s[m.settings.optgroupField]||"",i=0,n=(d=$.isArray(l)?l:[l])&&d.length;i<n;i++)l=d[i],m.optgroups.hasOwnProperty(l)||(l=""),o.hasOwnProperty(l)||(o[l]=document.createDocumentFragment(),r.push(l)),o[l].appendChild(a);for(this.settings.lockOptgroupOrder&&r.sort(function(t,e){return(m.optgroups[t].$order||0)-(m.optgroups[e].$order||0)}),p=document.createDocumentFragment(),e=0,b=r.length;e<b;e++)l=r[e],m.optgroups.hasOwnProperty(l)&&o[l].childNodes.length?((c=document.createDocumentFragment()).appendChild(m.render("optgroup_header",m.optgroups[l])),c.appendChild(o[l]),p.appendChild(m.render("optgroup",$.extend({},m.optgroups[l],{html:(f=c,v=void 0,(v=document.createElement("div")).appendChild(f.cloneNode(!0)),v.innerHTML),dom:c})))):p.appendChild(o[l]);if(C.html(p),m.settings.highlight&&w.query.length&&w.tokens.length)for(C.removeHighlight(),e=0,b=w.tokens.length;e<b;e++)!function(t,e){if("string"!=typeof e||e.length){var s="string"==typeof e?new RegExp(e,"i"):e,a=function(t){var e=0;if(3===t.nodeType){var i,n,o=t.data.search(s);0<=o&&0<t.data.length&&(n=t.data.match(s),(i=document.createElement("span")).className="highlight",(o=t.splitText(o)).splitText(n[0].length),n=o.cloneNode(!0),i.appendChild(n),o.parentNode.replaceChild(i,o),e=1)}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var r=0;r<t.childNodes.length;++r)r+=a(t.childNodes[r]);return e};t.each(function(){a(this)})}}(C,w.tokens[e].regex);if(!m.settings.hideSelected)for(e=0,b=m.items.length;e<b;e++)m.getOption(m.items[e]).addClass("selected");(u=m.canCreate(y))&&(C.prepend(m.render("option_create",{input:y})),g=$(C[0].childNodes[0])),m.hasOptions=0<w.items.length||u,m.hasOptions?(0<w.items.length?((O=O&&m.getOption(O))&&O.length?h=O:"single"===m.settings.mode&&m.items.length&&(h=m.getOption(m.items[0])),h&&h.length||(h=g&&!m.settings.addPrecedence?m.getAdjacentOption(g,1):C.find("[data-selectable]:first"))):h=g,m.setActiveOption(h),t&&!m.isOpen&&m.open()):(m.setActiveOption(null),t&&m.isOpen&&m.close())},addOption:function(t){var e,i,n,o=this;if($.isArray(t))for(e=0,i=t.length;e<i;e++)o.addOption(t[e]);else(n=o.registerOption(t))&&(o.userOptions[n]=!0,o.lastQuery=null,o.trigger("option_add",n,t))},registerOption:function(t){var e=_(t[this.settings.valueField]);return null!=e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=_(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,e){var i,n,o,r=this;if(t=_(t),i=_(e[r.settings.valueField]),null!==t&&r.options.hasOwnProperty(t)){if("string"!=typeof i)throw new Error("Value must be set in option data");o=r.options[t].$order,i!==t&&(delete r.options[t],-1!==(n=r.items.indexOf(t))&&r.items.splice(n,1,i)),e.$order=e.$order||o,r.options[i]=e,n=r.renderCache.item,o=r.renderCache.option,n&&(delete n[t],delete n[i]),o&&(delete o[t],delete o[i]),-1!==r.items.indexOf(i)&&(t=r.getItem(t),e=$(r.render("item",e)),t.hasClass("active")&&e.addClass("active"),t.replaceWith(e)),r.lastQuery=null,r.isOpen&&r.refreshOptions(!1)}},removeOption:function(t,e){var i=this;t=_(t);var n=i.renderCache.item,o=i.renderCache.option;n&&delete n[t],o&&delete o[t],delete i.userOptions[t],delete i.options[t],i.lastQuery=null,i.trigger("option_remove",t),i.removeItem(t,e)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,e){var i=this.$dropdown.find("[data-selectable]"),e=i.index(t)+e;return 0<=e&&e<i.length?i.eq(e):$()},getElementWithValue:function(t,e){if(null!=(t=_(t)))for(var i=0,n=e.length;i<n;i++)if(e[i].getAttribute("data-value")===t)return $(e[i]);return $()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(t,e){for(var i=$.isArray(t)?t:[t],n=0,o=i.length;n<o;n++)this.isPending=n<o-1,this.addItem(i[n],e)},addItem:function(r,s){i(this,s?[]:["change"],function(){var t,e,i,n=this,o=n.settings.mode;return r=_(r),-1!==n.items.indexOf(r)?void("single"===o&&n.close()):void(n.options.hasOwnProperty(r)&&("single"===o&&n.clear(s),"multi"===o&&n.isFull()||(t=$(n.render("item",n.options[r])),i=n.isFull(),n.items.splice(n.caretPos,0,r),n.insertAtCaret(t),n.isPending&&(i||!n.isFull())||n.refreshState(),n.isSetup&&(e=n.$dropdown_content.find("[data-selectable]"),n.isPending||(i=n.getOption(r),i=n.getAdjacentOption(i,1).attr("data-value"),n.refreshOptions(n.isFocused&&"single"!==o),i&&n.setActiveOption(n.getOption(i))),!e.length||n.isFull()?n.close():n.positionDropdown(),n.updatePlaceholder(),n.trigger("item_add",r,t),n.updateOriginalInput({silent:s})))))})},removeItem:function(t,e){var i,n,o=this,r=t instanceof $?t:o.getItem(t);t=_(r.attr("data-value")),-1!==(i=o.items.indexOf(t))&&(r.remove(),r.hasClass("active")&&(n=o.$activeItems.indexOf(r[0]),o.$activeItems.splice(n,1)),o.items.splice(i,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(t)&&o.removeOption(t,e),i<o.caretPos&&o.setCaret(o.caretPos-1),o.refreshState(),o.updatePlaceholder(),o.updateOriginalInput({silent:e}),o.positionDropdown(),o.trigger("item_remove",t,r))},createItem:function(t,i){var n=this,o=n.caretPos;t=t||$.trim(n.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(t))return r(),!1;n.lock();var e,s,a="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},l=(s=!(e=function(t){if(n.unlock(),!t||"object"!=typeof t)return r();var e=_(t[n.settings.valueField]);return"string"!=typeof e?r():(n.setTextboxValue(""),n.addOption(t),n.setCaret(o),n.addItem(e),n.refreshOptions(i&&"single"!==n.settings.mode),void r(t))}),function(){s||(s=!0,e.apply(this,arguments))}),t=a.apply(this,[t,l]);return void 0!==t&&l(t),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var t=!this.items.length;this.isInvalid=t,this.$control_input.prop("required",t),this.$input.prop("required",!t)},refreshClasses:function(){var t=this,e=t.isFull(),i=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",i).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!$.isEmptyObject(t.options)).toggleClass("has-items",0<t.items.length),t.$control_input.data("grow",!e&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,i,n,o,r=this;if(t=t||{},1===r.tagType){for(n=[],e=0,i=r.items.length;e<i;e++)o=r.options[r.items[e]][r.settings.labelField]||"",n.push('<option value="'+a(r.items[e])+'" selected="selected">'+a(o)+"</option>");n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),r.$input.html(n.join(""))}else r.$input.val(r.getValue()),r.$input.attr("value",r.$input.val());r.isSetup&&(t.silent||r.trigger("change",r.$input.val()))},updatePlaceholder:function(){var t;this.settings.placeholder&&(t=this.$control_input,this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0}))},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&(t.hideInput(),t.$control_input.blur()),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(t){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.lastQuery=null,e.setCaret(0),e.setActiveItem(null),e.updatePlaceholder(),e.updateOriginalInput({silent:t}),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length);0===e?this.$control.prepend(t):$(this.$control[0].childNodes[e]).before(t),this.setCaret(e+1)},deleteSelection:function(t){var e,i,n,o,r,s=this,a=t&&8===t.keyCode?-1:1,l=d(s.$control_input[0]);if(s.$activeOption&&!s.settings.hideSelected&&(o=s.getAdjacentOption(s.$activeOption,-1).attr("data-value")),n=[],s.$activeItems.length){for(r=s.$control.children(".active:"+(0<a?"last":"first")),r=s.$control.children(":not(input)").index(r),0<a&&r++,e=0,i=s.$activeItems.length;e<i;e++)n.push($(s.$activeItems[e]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(s.isFocused||"single"===s.settings.mode)&&s.items.length&&(a<0&&0===l.start&&0===l.length?n.push(s.items[s.caretPos-1]):0<a&&l.start===s.$control_input.val().length&&n.push(s.items[s.caretPos]));if(!n.length||"function"==typeof s.settings.onDelete&&!1===s.settings.onDelete.apply(s,[n]))return!1;for(void 0!==r&&s.setCaret(r);n.length;)s.removeItem(n.pop());return s.showInput(),s.positionDropdown(),s.refreshOptions(!0),o&&((o=s.getOption(o)).length&&s.setActiveOption(o)),!0},advanceSelection:function(t,e){var i,n,o,r=this;0!==t&&(r.rtl&&(t*=-1),o=0<t?"last":"first",i=d(r.$control_input[0]),r.isFocused&&!r.isInputHidden?(n=r.$control_input.val().length,(t<0?0!==i.start||0!==i.length:i.start!==n)||n||r.advanceCaret(t,e)):(o=r.$control.children(".active:"+o)).length&&(o=r.$control.children(":not(input)").index(o),r.setActiveItem(null),r.setCaret(0<t?o+1:o)))},advanceCaret:function(t,e){var i,n=this;0!==t&&(i=0<t?"next":"prev",n.isShiftDown?(i=n.$control_input[i]()).length&&(n.hideInput(),n.setActiveItem(i),e&&e.preventDefault()):n.setCaret(n.caretPos+t))},setCaret:function(t){var e=this;if(t="single"===e.settings.mode?e.items.length:Math.max(0,Math.min(e.items.length,t)),!e.isPending)for(var i,n=e.$control.children(":not(input)"),o=0,r=n.length;o<r;o++)i=$(n[o]).detach(),o<t?e.$control_input.before(i):e.$control.append(i);e.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.$control_input.prop("disabled",!1).prop("tabindex",t.tabIndex),t.isDisabled=!1,t.unlock()},destroy:function(){var t=this,e=t.eventNS,i=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),$(window).off(e),$(document).off(e),$(document.body).off(e),delete t.$input[0].selectize},render:function(t,e){var i,n="",o=!1,r=this;return(o="option"===t||"item"===t?!!(i=_(e[r.settings.valueField])):o)&&(l(r.renderCache[t])||(r.renderCache[t]={}),r.renderCache[t].hasOwnProperty(i))?r.renderCache[t][i]:(n=$(r.settings.render[t].apply(this,[e,a])),"option"===t||"option_create"===t?n.attr("data-selectable",""):"optgroup"===t&&(e=e[r.settings.optgroupValueField]||"",n.attr("data-group",e)),"option"!==t&&"item"!==t||n.attr("data-value",i||""),o&&(r.renderCache[t][i]=n[0]),n[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),O.count=0,O.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},$.fn.selectize=function(n){function o(t,s){function a(t){return"string"==typeof(t=c&&t.attr(c))&&t.length?JSON.parse(t):null}function l(t,e){t=$(t);var i,n=_(t.val());(n||p.allowEmptyOption)&&(d.hasOwnProperty(n)?e&&((i=d[n][g])?$.isArray(i)?i.push(e):d[n][g]=[i,e]:d[n][g]=e):((i=a(t)||{})[u]=i[u]||t.text(),i[h]=i[h]||n,i[g]=i[g]||e,d[n]=i,r.push(i),t.is(":selected")&&s.items.push(n)))}var e,i,n,o,r=s.options,d={};for(s.maxItems=t.attr("multiple")?null:1,e=0,i=(o=t.children()).length;e<i;e++)"optgroup"===(n=o[e].tagName.toLowerCase())?function(t){var e,i,n,o,r;for((n=(t=$(t)).attr("label"))&&((o=a(t)||{})[f]=n,o[v]=n,s.optgroups.push(o)),e=0,i=(r=$("option",t)).length;e<i;e++)l(r[e],n)}(o[e]):"option"===n&&l(o[e])}var r=$.fn.selectize.defaults,p=$.extend({},r,n),c=p.dataAttr,u=p.labelField,h=p.valueField,g=p.optgroupField,f=p.optgroupLabelField,v=p.optgroupValueField;return this.each(function(){var t,e,i;this.selectize||(t=$(this),e=this.tagName.toLowerCase(),i={placeholder:i=!(i=t.attr("placeholder")||t.attr("data-placeholder"))&&!p.allowEmptyOption?t.children('option[value=""]').text():i,options:[],optgroups:[],items:[]},("select"===e?o:function(t,e){var i,n,o,r,s=t.attr(c);if(s)for(e.options=JSON.parse(s),i=0,n=e.options.length;i<n;i++)e.items.push(e.options[i][h]);else{t=$.trim(t.val()||"");if(p.allowEmptyOption||t.length){for(i=0,n=(o=t.split(p.delimiter)).length;i<n;i++)(r={})[u]=o[i],r[h]=o[i],e.options.push(r);e.items=o}}})(t,i),new O(t,$.extend(!0,{},r,i,n)))})},$.fn.selectize.defaults=O.defaults,$.fn.selectize.support={validity:C},O.define("drag_drop",function(t){if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');var n,e,i,o;"multi"===this.settings.mode&&((n=this).lock=(o=n.lock,function(){var t=n.$control.data("sortable");return t&&t.disable(),o.apply(n,arguments)}),n.unlock=(i=n.unlock,function(){var t=n.$control.data("sortable");return t&&t.enable(),i.apply(n,arguments)}),n.setup=(e=n.setup,function(){e.apply(this,arguments);var i=n.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:n.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var t=n.$activeItems?n.$activeItems.slice():null,e=[];i.children("[data-value]").each(function(){e.push($(this).attr("data-value"))}),n.setValue(e),n.setActiveItem(t)}})}))}),O.define("dropdown_header",function(t){var e,i=this;t=$.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},t),i.setup=(e=i.setup,function(){e.apply(i,arguments),i.$dropdown_header=$(t.html(t)),i.$dropdown.prepend(i.$dropdown_header)})}),O.define("optgroup_columns",function(s){var n,a=this;s=$.extend({equalizeWidth:!0,equalizeHeight:!0},s),this.getAdjacentOption=function(t,e){var i=t.closest("[data-group]").find("[data-selectable]"),e=i.index(t)+e;return 0<=e&&e<i.length?i.eq(e):$()},this.onKeyDown=(n=a.onKeyDown,function(t){var e,i;return!this.isOpen||37!==t.keyCode&&39!==t.keyCode?n.apply(this,arguments):(a.ignoreHover=!0,e=(i=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),void((e=(i=(i=37===t.keyCode?i.prev("[data-group]"):i.next("[data-group]")).find("[data-selectable]")).eq(Math.min(i.length-1,e))).length&&this.setActiveOption(e)))});function t(){var t,e,i,n,o=$("[data-group]",a.$dropdown_content),r=o.length;if(r&&a.$dropdown_content.width()){if(s.equalizeHeight){for(t=e=0;t<r;t++)e=Math.max(e,o.eq(t).height());o.css({height:e})}s.equalizeWidth&&(n=a.$dropdown_content.innerWidth()-l(),i=Math.round(n/r),o.css({width:i}),1<r&&(i=n-i*(r-1),o.eq(r-1).css({width:i})))}}var l=function(){var t,e=l.width,i=document;return void 0===e&&((t=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,i.body.appendChild(t),e=l.width=t.offsetWidth-t.clientWidth,i.body.removeChild(t)),e};(s.equalizeHeight||s.equalizeWidth)&&(e.after(this,"positionDropdown",t),e.after(this,"refreshOptions",t))}),O.define("remove_button",function(t){t=$.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var r,e,i,n,s;return"single"===this.settings.mode?void function(i,n){n.className="remove-single";var o,r=i,s='<a href="javascript:void(0)" class="'+n.className+'" tabindex="-1" title="'+a(n.title)+'">'+n.label+"</a>";i.setup=(o=r.setup,function(){var t,e;n.append&&(t=$(r.$input.context).attr("id"),$("#"+t),e=r.settings.render.item,r.settings.render.item=function(t){return e.apply(i,arguments)+s}),o.apply(i,arguments),i.$control.on("click","."+n.className,function(t){t.preventDefault(),r.isLocked||r.clear()})})}(this,t):(n=r=this,s='<a href="javascript:void(0)" class="'+(e=t).className+'" tabindex="-1" title="'+a(e.title)+'">'+e.label+"</a>",void(r.setup=(i=n.setup,function(){var o;e.append&&(o=n.settings.render.item,n.settings.render.item=function(t){return e=o.apply(r,arguments),i=s,n=e.search(/(<\/[^>]+>\s*)$/),e.substring(0,n)+i+e.substring(n);var e,i,n}),i.apply(r,arguments),r.$control.on("click","."+e.className,function(t){t.preventDefault(),n.isLocked||(t=$(t.currentTarget).parent(),n.setActiveItem(t),n.deleteSelection()&&n.setCaret(n.items.length))})})))}),O.define("restore_on_backspace",function(i){var n,t=this;i.text=i.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(n=t.onKeyDown,function(t){var e;return 8===t.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&(0<=(e=this.caretPos-1)&&e<this.items.length)?(e=this.options[this.items[e]],this.deleteSelection(t)&&(this.setTextboxValue(i.text.apply(this,[e])),this.refreshOptions(!0)),void t.preventDefault()):n.apply(this,arguments)})}),O}),function(f){var h={text:"",types:[],tags:[],inactive:!1};function n(){for(var t=[],e=0;e<widget_data.length;e++){var i=!1,n=widget_data[e],o=!0;h.text,""===h.text||-1===n.name.toLowerCase().indexOf(h.text.toLowerCase())&&(o=!1);var r=!0;0<h.types.length&&-1===f.inArray(n.type,h.types)&&(r=!1);var s=!0;if(0<h.tags.length){for(var a=!1,l=0,d=0;d<n.tags.length;d++)-1!==f.inArray(n.tags[d],h.tags)&&(a=!0,l++);!a||1<h.tags.length&&l<h.tags.length?s=!1:console.log(l)}var p=!0;h.inactive&&!0===n.active&&(p=!1),(i=""===h.text&&0===h.types.length&&0===h.tags.length&&!1===h.inactive||o&&r&&s&&p?!0:i)&&t.push(f(".widget[id$="+n.id+"]"))}f("#everyboard_widgets .widget").hide();for(var c=0;c<t.length;c++)t[c].show();var u=f(".widget-holder .filter-information");f(".filtered-widget-count",u).empty().html(t.length)}f(document).ready(function(){f("#widget-list").children(".widget").draggable({connectToSortable:"#everyboard_widgets",handle:"> .widget-top > .widget-title",distance:2,helper:function(){var t=f(this).clone(),e=f("#everyboard_widgets"),i=f(e).width();return 1500<=window.innerWidth?i=(f(e).width()-10)/3:1e3<=window.innerWidth&&(i=(f(e).width()-10)/2),t.css({"min-width":i+"px"}),t},zIndex:5,containment:"document",revert:"invalid",start:function(t,e){e.helper.find("div.widget-description").hide(),this.id},stop:function(t,e){}}),function(){for(var t=f(".filter-container .filter-body"),e=[],i=[],n={},o={},r=0,s=0;s<widget_data.length;s++){var a=widget_data[s].type;-1===f.inArray(a,e)&&e.push(a),n.hasOwnProperty(a)?n[a]++:n[a]=1;for(var l=widget_data[s].tags,d=0;d<l.length;d++){var p=l[d];-1===f.inArray(p,i)&&i.push(p),o.hasOwnProperty(p)?o[p]++:o[p]=1}!1===widget_data[s].active&&r++}e.sort();for(var c=f("<div />").attr({class:"type-container filter-section"}).html("<h4>"+translation_boardwidgets.filter_by_type+"</h4>"),s=0;s<e.length;s++){var u=f("<input />").attr({type:"button",value:e[s]+" ("+n[e[s]]+")",class:"type-filter filter-btn"}).data("type",e[s]);c.append(u)}t.append(c),i.sort();for(var h=f("<div />").attr({class:"tag-container filter-section"}).html("<h4>"+translation_boardwidgets.filter_by_tag+"</h4>"),s=0;s<i.length;s++){u=f("<input />").attr({type:"button",value:i[s]+" ("+o[i[s]]+")",class:"tag-filter filter-btn"}).data("tag",i[s]);h.append(u)}t.append(h);var g=f("<div />").attr({class:"inactive-container filter-section"}).html("<h4>"+translation_boardwidgets.filter_by_inactive_widgets+"</h4>"),u=f("<input />").attr({type:"button",value:translation_boardwidgets.inactive+" ("+r+")",class:"inactive-filter filter-btn"}).data("inactive",!0);g.append(u),t.append(g);g=f(".widget-holder .filter-information");g.empty().append(translation_boardwidgets.showing+' <span class="filtered-widget-count">'+widget_data.length+"</span> "+translation_boardwidgets.of+" "+widget_data.length+" "+translation_boardwidgets.widgets+".");u=f("<input />").attr({type:"button",value:translation_boardwidgets.clear_all_filters,class:"clear-filters filter-btn"});g.append(u),f(".widgetprefab .filter-container .filter-header .loader").remove(),f(".widgetprefab .filter-container .filter-action").show(),f(".widgetprefab .widget-liquid-left .widget-holder").show(),f(".widgetprefab .widget-liquid-right").show()}();var t=f(".widget-liquid-right #widget-list .widget");f(".widget-liquid-right #filter_widgets").on("input",function(){t.css("display","block"),0<f("#filter_widgets").val().length&&t.filter(function(t){return f("h3",this).html().toLowerCase().indexOf(f("#filter_widgets").val().toLowerCase())<0}).css("display","none")}),f("#input-filter-active-widgets").on("input",function(){var t=f(this).val();-1<t.length&&(h.text=t,n())}),f(".toggle-filters").on("click",function(){var t=f(".widgetprefab .filter-container .filter-body"),e=f(this);return t.is(":hidden")?e.val(translation_boardwidgets.hide_widget_filters):e.val(translation_boardwidgets.show_widget_filters),t.slideToggle(),!1}),f(".type-filter").on("click",function(){var t=f(this),e=t.data("type");if(t.hasClass("active")){t.removeClass("active");for(var i=h.types.length-1;0<=i;i--)if(h.types[i]===e){h.types.splice(i,1);break}}else t.addClass("active"),h.types.push(e);n()}),f(".tag-filter").on("click",function(){var t=f(this),e=t.data("tag");if(t.hasClass("active")){t.removeClass("active");for(var i=h.tags.length-1;0<=i;i--)if(h.tags[i]===e){h.tags.splice(i,1);break}}else t.addClass("active"),h.tags.push(e);n()}),f(".inactive-filter").on("click",function(){var t=f(this),e=t.data("inactive");(h.inactive=e)?(t.addClass("active"),t.data("inactive",!1)):(t.removeClass("active"),t.data("inactive",!0)),n()}),f(".clear-filters").on("click",function(){h.text="",f("#input-filter-active-widgets").val(""),h.types=[],f(".type-filter").removeClass("active"),h.tags=[],f(".tag-filter").removeClass("active"),h.inactive=!1,f(".inactive-filter").removeClass("active").data("inactive",!0),n()})})}(jQuery);