!function(c){var d=d||{};d.minimized=!1,d.dragCounter=0,d.settings={},d.connectedToOc=null,d.ocHealthInterval=null,d.currentList=null,d.lastClick=null,d.currentAction=null,d.actions={Default:"DEFAULT",Save:"SAVE",Sort:"SORT",LoadArticle:"LOAD_ARTICLE"},d.lastAction=d.actions.Default,d.numberOfItemToSave=20,d.messageVisible=!1,d.articlesInList=[],d.templates={listItem:function(t){var e,i,s=new Date(t.pubdate[0]),a=new Date,n=s.getTime()>a.getTime()?"future":"",r="",o="",l=""!==d.settings.property?d.settings.property.toLowerCase():"status",c=""!==d.settings.value?d.settings.value.toLowerCase():"publicerad",u=d.minimized?"minimized":"";void 0!==t[l]&&null!==t[l]&&void 0!==t[l][0]&&""!==t[l][0]&&(r=t[l][0].toLowerCase()===c?"published":""),void 0!==t[l]&&null!==t[l]&&void 0!==t[l][0]&&""!==t[l][0]&&(o=void 0!==t[l]?t[l][0]:"&laquo No status property in OC response &raquo"),void 0!==t.headline&&null!==t.headline&&void 0!==t.headline[0]&&""!==t.headline[0]&&(i=void 0!==t.headline?t.headline[0]:"&laquo Missing headline &raquo;"),void 0!==t.section&&null!==t.section&&void 0!==t.section[0]&&""!==t.section[0]&&(e=void 0!==t.section?t.section[0]:"");a="",c=""!==a?"has-image":"";return void 0!==eb_settings.image_service&&("imgix"===eb_settings.image_service&&void 0!==t.imagepreviews&&null!==t.imagepreviews&&void 0!==t.imagepreviews[0]&&""!==t.imagepreviews[0]?((l=document.createElement("a")).href=t.imagepreviews[0],void 0!==l.pathname&&(a='<img src="'+eb_settings.image_base+l.pathname+'?w=50&h=50&fit=crop&crop=entropy&auto=format"/>')):void 0!==t.imageuuid&&void 0!==t.imageuuid[0]&&""!==t.imageuuid[0]&&(a='<img src="'+eb_settings.image_base+"?uuid="+t.imageuuid[0]+'&type=preview&source=false&function=thumbnail&width=140&height=90&q=60"/>')),'<div class="sortable list-item '+n+" "+r+" "+u+" "+c+'" data-uuid="'+t.uuid[0]+'" data-pubdate="'+s.getTime()+'" data-status="'+o+'"><div class="ui-draggable-handle"></div><div class="order"></div><div class="top-border"><p class="article-headline">'+i+'</p><div class="remove-list-item"></div></div><div class="content"><div class="image">'+a+"</div><ul><li>Avdelning: "+e+"</li><li>Pubdatum: "+"{{1}} {{2}} {{3}} kl {{4}}".format([s.getDate(),s.getMonthText(),s.getFullYear(),s.toTimeString().substr(0,5)])+"</li><li>Status: "+o+"</li><li>Uuid: "+t.uuid[0]+"</li></ul></div></div>"},noConnectionListItem:function(t){var e=new Date(t.pubdate),i=new Date,s=e.getTime()>i.getTime()?"future":"",a=(""!==d.settings.property&&d.settings.property.toLowerCase(),""!==d.settings.value?d.settings.value.toLowerCase():"publicerad"),i=d.minimized?"minimized":"";return'<div class="sortable list-item no-connection-item '+s+" "+(void 0!==t.status&&t.status.toLowerCase()===a?"published":"")+" "+i+' " data-uuid="'+t.uuid+'" data-pubdate="'+e.getTime()+'" data-status="'+t.status+'"><div class="ui-draggable-handle"></div><div class="order"></div><div class="top-border"><p class="article-headline">'+t.uuid+'</p><div class="remove-list-item"></div></div><div class="content"><div class="image"></div><ul><li>Issue: '+t.status+"</li><li>Uuid: "+t.uuid+"</li></ul></div></div>"},tempListItem:function(){return'<div class="list-item temp-item"></div>'},listWrapper:function(t){return'<div id="list-wrapper"><div class="network-share"><input class="list-network-share" type="checkbox" '+(void 0!==t.options&&1===t.options.shared?'checked="true"':"")+' /> Share this list within networked sites</div><div><input class="list-name-input" type="text" placeholder="Listname..." value="'+t.name+'"></div></div>'},saveListButton:function(t){return'<input class="save-list" type="button" data-list-id="'+t+'" value="Save"/>'},removeListButton:function(t){return'<input class="remove-list" type="button" data-list-id="'+t+'" value="Remove"/>'},generateUrlButton:function(t){return'<input class="generate-list-url" type="button" data-list-id="'+t+'" value="Generate NP URL" />'},minimizeListButton:function(){return'<input class="minimize-list-button" type="button" value="Minimize" />'},refreshButton:function(t){return'<input class="refresh-list-button" type="button" data-list-id="'+t+'" value="Refresh" />'},iframeButtons:function(i,t){var s="";return t.forEach(function(t){var e=(e=t.src).replace("_LISTID_",i);s+='<input class="iframe-list-button" type="button" data-list-id="'+i+'" data-href="'+e+'" data-title="'+t.title+'" value="'+t.title+'" />'}),s},captionDivider:function(t,e){return'<div class="sortable structure-item caption-divider" data-position="'+t+'"><span class="text">'+e+'</span><div class="ui-draggable-handle"><span class="fa fa-arrows-v"></span></div><div class="remove-structure-item"></div></div>'},structureItemCaptionDivider:function(){return'<div class="list-structure-items"><div class="structure-item">Caption Divider</div></div>'},spinner:function(){return'<div class="sk-fading-circle"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>'},iframeInterface:function(t,e,i){return'<div class="iframe-page-container"><div class="top-bar"><span class="close-iframe-interface"></span><h2>'+e+'</h2></div><div class="iframe-container"><iframe src="'+i+'"></iframe></div></div>'}},d.getMenuActionBar=function(t){return'<div class="menu-action-bar">'+this.templates.saveListButton(t.id)+this.templates.generateUrlButton(t.id)+this.templates.minimizeListButton()+this.templates.refreshButton(t.id)+this.templates.removeListButton(t.id)+this.templates.iframeButtons(t.id,eb_settings.iframe_buttons)+"</div>"},d.generateListUrl=function(t){t=c(t.target).data("list-id");this.generateListUrlDialog(eb_settings.list_url_base+"list-login.php?listid="+t+"&username=[username]&password=[password]")},d.removeListItem=function(t){var e=c(t.target),t=e.hasClass("list-item")?e:e.parents(".list-item"),e=t.data("uuid");t.remove();e=this.articlesInList.indexOf(e);-1!=e&&this.articlesInList.splice(e,1),this.updateWrapperHeight(),this.calculateOrder(),this.numberOfItemToSave>=this.articlesInList.length&&this.messageVisible&&this.hideMessage()},d.removeList=function(t){this.removeConfirmDialog().then(function(){var e=c(t.target).data("list-id");c.post(ajaxurl,{action:"remove_board_list",listId:e},function(t){200===t.status?(this.removeListFromSelect(e),this.triggerMessage(c("#main-message-wrapper"),"Successfully removed the list","success"),c(".list-area").html("")):this.triggerMessage(c("#main-message-wrapper"),t.error,"error")}.bind(this),"json")}.bind(this),function(){})},d.removeStructureItem=function(t){c(t.target).parent(".structure-item").remove(),this.lastAction=this.actions},d.saveList=function(s){var t,e,a,i,n,r,o,l;d.currentAction===d.actions.LoadArticle?d.triggerMessage(c("#main-message-wrapper"),"An article is currently loading, please wait and try again","warning",!1):(t=c(".list-item"),e=c("#list-wrapper").find(".structure-item"),a=c(".list-name-input").val(),i={},n=""!==d.settings.number_of_items_to_save?d.settings.number_of_items_to_save:20,r=!1,o=c(".list-network-share","#list-wrapper").is(":checked")?1:0,l=c(s.target).data("list-id"),i.listname=a,i.articles=[],i.structures={},i.options={},t.each(function(t){var e=c(this).data("uuid");n<=t?r=!0:i.articles.push(e)}),e.each(function(t){var e=c(this).attr("data-position");i.structures[t]={position:e,text:c(this).find(".text").text()}}),i.options.shared=o,c.post(ajaxurl,{action:"save_board_list",listData:JSON.stringify(i),listId:l,listTitle:a,timestamp:d.currentList.timestamp,shared:o},function(t){var e="List saved successfully",i="";200===t.status?(i="success",this.updateListInSelect({id:l,name:a}),console.log(t.list.data),this.lastAction=this.actions.Save,this.currentList=JSON.parse(t.list.data),r&&this.refreshList(s)):(e=t.error,i=0===t.status?"error":"warning"),this.triggerMessage(c("#main-message-wrapper"),e,i)}.bind(this),"json"))},d.addListToSelect=function(t){$ele=c('<option selected value="'+t.id+'" data-list-name="'+t.name+'">'+t.name+"</option>"),c(".list-selector").append($ele)},d.removeListFromSelect=function(t){c(".list-selector option:selected").remove()},d.updateListInSelect=function(t){c(".list-selector option:selected").text(t.name).attr("data-list-name",t.name)},d.loadList=function(i){this.hasActiveList().then(function(){this.articlesInList=[],this.showLoader(),this.hideMessage(),c.post(ajaxurl,{action:"get_board_list",listId:i},function(t){var e;200===t.status||400===t.status?(e=JSON.parse(t.data),console.log(e),d.currentList=e,this.renderList({name:e.listname,id:i,options:e.options}).then(this.makeSortable()).then(this.structureItemSortable()).then(function(){var i=c("#list-wrapper");200===t.status?(console.log(t.articles),c.each(t.articles,function(t,e){void 0!==d.settings.property&&null!==d.settings.property&&void 0!==e[d.settings.property.toLowerCase()]?(this.articlesInList.push(e.uuid[0]),i.append(this.templates.listItem(e))):i.append(this.templates.noConnectionListItem({uuid:e.uuid,pubdate:"",status:"Problem loading object"}))}.bind(this))):c.each(e.articles,function(t,e){console.log(e),this.articlesInList.push(e),i.append(this.templates.noConnectionListItem({uuid:e,pubdate:"",status:"Problem loading object"}))}.bind(this)),void 0!==e.structures&&c.each(e.structures,function(t,e){this.renderCaptionDivider(e)}.bind(this)),c(".list-structure-items").show(),this.calculateOrder(),this.updateWrapperHeight(),this.lastAction=this.actions.Default,d.numberOfItemToSave<this.articlesInList.length&&!this.messageVisible&&this.triggerMessage(c("#main-message-wrapper"),"Your list contains more items then what will be saved. The number that will be saved are "+d.numberOfItemToSave,"warning",!1)}.bind(this))):this.triggerMessage(c("#main-message-wrapper"),"Could not load list","error")}.bind(this),"json")}.bind(this))},d.showLoader=function(){c(this.listarea).html(this.templates.spinner)},d.renderCaptionDivider=function(t){c("#list-wrapper").append(this.templates.captionDivider(t.position,t.text))},d.triggerMessage=function(t,e,i,s){var a=c('<p class="list-message '+i+'">'+e+"</p>"),s=!1!==s;0<i.indexOf("warning")&&(this.messageVisible=!0),s||(i=c('<i class="js-list__message--close fa fa-close"></i>'),c(i).click(function(){c(this).parents(".list-message").remove()}),a.append(i)),t.append(a),s&&setTimeout(function(){a.slideToggle(400,function(){})},12e3)},d.hideMessage=function(){this.messageVisible=!1,c("#main-message-wrapper").find("p").slideUp()},d.calculateOrder=function(){var t=1;c(".list-item:not(.ui-sortable-helper)").each(function(){c(this).hasClass("future")||!c(this).hasClass("published")||c(this).hasClass("ui-sortable-placeholder")||(c(this).find(".order").html(t),t++),!c(this).hasClass("ui-sortable-placeholder")||c(this).hasClass("future")||c(this).hasClass("no-connection-item")||(c(".list-item.ui-sortable-helper").find(".order").html(t),t++)}),c(".caption-divider").each(function(){var t=parseInt(c(this).attr("data-position"));c(this).insertBefore("#list-wrapper .list-item:not(.ui-sortable-helper):eq("+t+")")})},d.hasActiveList=function(){var i=this;return c.Deferred(function(){var t,e=this;void 0!==i.active_list&&i.lastAction!==i.actions.Default&&i.lastAction!==i.actions.Save?(t=c('<div id="list-dialog">'+everylist_translate.modal_active_list_message+"</div>"),c("body").append(t),t.dialog({resizeable:!1,modal:!0,buttons:[{text:everylist_translate.modal_proceed,click:function(){e.resolve(),c(this).dialog("close")}},{text:everylist_translate.modal_cancel,click:function(){c(this).dialog("close")}}]})):e.resolve()})},d.createListPost=function(){var t=this;return c.Deferred(function(){var i=this;c("#create-list-dialog").find("#listname").val("").on("keydown",function(t){if(13===t.keyCode)return s.parents(".ui-dialog").find(".ui-button-text-only").click(),t.preventDefault(),!1});var s=c("#create-list-dialog").dialog({resizable:!1,modal:!0,buttons:[{text:"Create",click:function(){var t=c("#listname").val(),e=c('.list-selector option[data-list-name="'+t.toLowerCase()+'"]').length;""===t?this.triggerMessage(c(".create-list-dialog").find(".message-wrapper"),everylist_translate.validate_no_list_name,"error"):0!==e?this.triggerMessage(c(".create-list-dialog").find(".message-wrapper"),everylist_translate.validate_duplicated_list_name,"error"):(c.post(ajaxurl,{action:"create_board_list",listname:t},function(t){200===t.status?i.resolve(t.list):i.reject(t.error)},"json"),s.dialog("destroy"))}.bind(t)}]})})},d.renderList=function(t){var e=this;return c.Deferred(function(){c(e.listarea).html("").append(e.getMenuActionBar(t),e.templates.listWrapper(t),e.templates.structureItemCaptionDivider()),this.resolve()})},d.structureItemSortable=function(){c(".structure-item",".list-structure-items").draggable({connectToSortable:"#list-wrapper",revert:!1,helper:function(){return d.templates.captionDivider(0,"Caption Divider")},start:function(t,e){c(e.helper[0]).css({width:c("#list-wrapper").width()+"px"})},stop:function(t,e){d.calculateCaptionDividerPosition(e.helper[0]),c(e.helper[0]).addClass("caption-divider").removeAttr("style").removeClass("ui-draggable-handle")}})},d.makeSortable=function(){var t=c("#list-wrapper");t.sortable({delay:150,cursor:"move",items:".sortable",axis:"y",handle:".ui-draggable-handle",scrollSensitivity:30,update:function(t,e){e.item.hasClass("caption-divider")?this.calculateCaptionDividerPosition(e.item[0]):(this.calculateOrder(),this.updateWrapperHeight()),this.lastAction=this.actions.Sort}.bind(this),change:function(){this.calculateOrder()}.bind(this),start:function(t,e){c(e.placeholder).css({height:c(e.item).height()})}}),t.disableSelection(),d.active_list=t},d.calculateCaptionDividerPosition=function(i){var s=0;c(".sortable","#list-wrapper").each(function(t,e){e===i&&c(i).attr("data-position",s),c(e).hasClass("structure-item")||s++})},d.updateWrapperHeight=function(){var t=250,e=c("#list-wrapper");e.children(".sortable").each(function(){t+=c(this).outerHeight()}),e.css({"min-height":t})},d.minimizeList=function(){d.minimized=!d.minimized,c(".minimize-list-button").val(d.minimized?"Maximize":"Minimize"),c(".list-item","#list-wrapper").each(function(){c(this).toggleClass("minimized")}),this.updateWrapperHeight()},d.refreshList=function(t){this.lastAction=this.actions.Default,this.active_list=void 0;t=c(t.target).data("list-id");this.loadList(t)},d.iframeButton=function(t){var e=c(t.currentTarget),i=e.data("list-id"),t=e.data("href"),e=e.data("title");c("body").append(this.templates.iframeInterface(i,e,t))},d.closeIframeInterface=function(t){c(".iframe-page-container").remove()},d.createList=function(){this.hasActiveList().then(function(){this.createListPost().then(function(t){this.currentList=t,this.articlesInList=[],this.addListToSelect(t),this.renderList(t),this.makeSortable()}.bind(this),function(t){this.triggerMessage(c("#main-message-wrapper"),t,"error")}.bind(this))}.bind(this))},d.handleArticleDrop=function(t){d.lastClick=(new Date).getTime();var e="",i=[];if(void 0!==t.originalEvent.dataTransfer.getData("text")&&""!==t.originalEvent.dataTransfer.getData("text")){if((e=t.originalEvent.dataTransfer.getData("text")).split("\n").forEach(function(t){var e;/opencontent\/objects/.test(t)?(e=t.match(/(.+\/)objects\/([^\/]+)/i),i.push(e[2])):/\/#[a-z0-9\-]{36}/.test(t)&&(t=t.match(/\/#([a-z0-9\-]{36})/),i.push(t[1]))}),0===i.length)try{var s=JSON.parse(e);s.hasOwnProperty("uuid")&&i.push(s.uuid)}catch(t){console.log("Error: Could not parse json drop data: "+e)}}else void 0!==t.originalEvent.dataTransfer.getData("text/uri-list")&&""!==t.originalEvent.dataTransfer.getData("text/uri-list")&&(e=t.originalEvent.dataTransfer.getData("text/uri-list")).split("\n").forEach(function(t){t=d.getUrlParameterByName("data",t);null===t||""===t||void 0!==(t=JSON.parse(t)).uuid&&""!==t.uuid&&i.push(t.uuid)});return 0<i.length?i.forEach(function(i){var t;d.currentAction=d.actions.LoadArticle,void 0!==i?0<=this.articlesInList.indexOf(i)?(this.duplicateDialog(),this.clearUpDrop(),d.currentAction=null):(t=c("#list-wrapper").find(".loading_article"),c(this.templates.tempListItem()).insertAfter(t),t.remove(),t={action:"list_get_article",uuid:i,render:"false"},c.post(ajaxurl,t,function(t){var e=c("#list-wrapper").find(".temp-item");null!==t&&"object"==typeof t?0<e.length?c(this.templates.listItem(t)).insertAfter(e):c("#list-wrapper").append(this.templates.listItem(t)):!d.connectedToOc||null!==t&&"object"==typeof t?(console.log("no connection: "+d.connectedToOc),(t={}).uuid=i,t.pubdate=0,t.status="unknown",0<e.length?c(this.templates.noConnectionListItem(t)).insertAfter(e):c("#list-wrapper").append(this.templates.noConnectionListItem(t))):this.triggerMessage(c("#main-message-wrapper"),"Could not find article with uuid: "+i+" in external OpenContent.<br />This could be due to environment queries or the article isn't transferred correctly","error",!1),this.articlesInList.push(i),this.lastAction=this.actions.Sort,this.updateWrapperHeight(),this.calculateOrder(),d.numberOfItemToSave<this.articlesInList.length&&!this.messageVisible&&this.triggerMessage(c("#main-message-wrapper"),"Your list contains more items then what will be saved. The number that will be saved are "+d.numberOfItemToSave,"warning",!1),this.clearUpDrop(),this.currentAction=null}.bind(this),"json")):(this.triggerMessage(c("#main-message-wrapper"),"Could not parse UUID from dropped link","error"),this.clearUpDrop(),this.currentAction=null)}.bind(this)):(this.triggerMessage(c("#main-message-wrapper"),"Could not parse UUID from dropped link","error"),this.clearUpDrop()),!1},d.clearUpDrop=function(){this.dragCounter=0,c(".dropArea, .temp-item, .loading_article").remove()},d.handleArticleEnter=function(t,e){e.find(".dropArea").length<1&&c("<textarea/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,opacity:0,zIndex:9999,display:"block",width:"100%",height:"100%",color:"#000"}).attr("class","dropArea").appendTo(c(e))},d.handleArticleDragover=function(t,e){var i=c(".list-item:not(.loading_article)",e),s=[],a=void 0;if(0<i.length){i.each(function(){s.push({center:c(this).position().top,height:c(this).outerHeight(),element:c(this)})});for(var n=t.originalEvent.clientY-(e.offset().top-c(document).scrollTop()),a=(t.originalEvent.clientX,i[i.length-1]),r=!1,o=0;o<s.length;o++){var l=s[o];if(n<=l.center){a=l.element,r=!0;break}if(n>l.center&&(a=l.element,r=!1,n<l.center+l.height/2))break}}t=c("<div/>",{class:"list-item placeholder-item ui-sortable-placeholder loading_article"}),i=e.find(".loading_article");void 0!==a?r?c(t).insertBefore(a):c(t).insertAfter(a):e.append(t),1<=i.length&&i.remove()},d.duplicateDialog=function(){c("#duplicate-dialog").dialog({resizable:!1,modal:!0,buttons:[{text:"ok",click:function(){c(this).dialog("close")}}]})},d.generateListUrlDialog=function(t){var e=c("#generate-list-url-dialog");e.find("#list-url-textbox").val(t),e.dialog({resizable:!1,modal:!0,buttons:[{text:"ok",click:function(){c(this).dialog("close")}}]})},d.removeConfirmDialog=function(){return c.Deferred(function(){var t=this;c("#remove-list-dialog").dialog({resizable:!1,modal:!0,buttons:[{text:"Remove",click:function(){c(this).dialog("close"),t.resolve()}},{text:"Cancel",click:function(){c(this).dialog("close"),t.reject()}}]})})},d.editCaptionText=function(t){var e=c(t.target),t=c(e).html(),i=c('<input type="text" value="'+t+'" />');c(e).html(i),c(i).focus(),c(i).select();function s(t){return t.replace(/[&<>]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;"}[t]||t})}c(i).on("keydown",function(t){13===t.keyCode&&c(e).html(s(c(t.target).val()))}),c(i).on("blur",function(){c(e).html(s(c(i).val()))}),c(".ui-draggable-handle").on("click",function(){c(i).blur()})},d.setupListeners=function(){c(document).on("click","#everylist_create",c.proxy(this.createList,this)),c(document).on("click",".save-list",c.proxy(this.saveList,this)),c(document).on("click",".remove-list-item",c.proxy(this.removeListItem,this)),c(document).on("click",".remove-structure-item",c.proxy(this.removeStructureItem,this)),c(document).on("click",".remove-list",c.proxy(this.removeList,this)),c(document).on("click",".generate-list-url",c.proxy(this.generateListUrl,this)),c(document).on("click",".minimize-list-button",c.proxy(this.minimizeList,this)),c(document).on("click",".refresh-list-button",c.proxy(this.refreshList,this)),c(document).on("click",".iframe-list-button",c.proxy(this.iframeButton,this)),c(document).on("click",".close-iframe-interface",c.proxy(this.closeIframeInterface,this)),c(document).on("click","html:not(.newspilot) .structure-item.caption-divider .text",c.proxy(this.editCaptionText,this)),c(document).on("change",".list-selector",function(t){t=c(t.target).find(":selected").val();this.loadList(t)}.bind(this)),c(window).on("resize",function(){setTimeout(this.updateWrapperHeight,17)}.bind(this)),c(document).on("dragenter dragover drop dragend",function(t){return t.stopPropagation(),t.preventDefault(),!1}),c(document).on("dragleave","#list-wrapper",function(t){t.stopPropagation(),t.preventDefault(),this.dragCounter--,this.dragCounter<=0&&this.clearUpDrop()}.bind(this)),c(document).on("dragenter","#list-wrapper",function(t){return t.stopPropagation(),t.preventDefault(),this.dragCounter++,this.handleArticleEnter(t,c("#list-wrapper")),!1}.bind(this)),c(document).on("dragover","#list-wrapper",function(t){return t.stopPropagation(),t.preventDefault(),this.handleArticleDragover(t,c("#list-wrapper")),!1}.bind(this)),c(document).on("drop",function(t){return t.stopPropagation(),t.preventDefault(),t.target===c("#list-wrapper")[0]||0<c(t.target).parents("#list-wrapper").length?this.handleArticleDrop(t):this.clearUpDrop(),!1}.bind(this))},d.setupOcConnectionCheck=function(){function t(){(new Date).getTime()-d.lastClick<1e4&&c.post(ajaxurl,{action:"check_oc_health"},function(t){d.setConnectionStatus(200===t.status)},"json")}t(),d.ocHealthInterval=setInterval(t,3e4)},d.setConnectionStatus=function(t){!1===d.connectedToOc&&t?this.resumedOcConnection():!0!==d.connectedToOc||t||this.droppedOcConnection(),d.connectedToOc=t},d.resumedOcConnection=function(){var t=c("#main-message-wrapper");t.find(".oc-warning").slideToggle(),this.triggerMessage(t,"Resumed connection to OpenContent","success",!0);var i=[];c(".no-connection-item","#list-wrapper").each(function(t,e){i.push(c(e).data("uuid"))});t={action:"fetch_articles",uuids:i};c.post(ajaxurl,t,function(t){200===t.status?this.updateDisconnectedListItems(t.articles):c(".no-connection-item","#list-wrapper").each(function(t,e){d.removeListItem({target:c(e)})})}.bind(this),"json")},d.updateDisconnectedListItems=function(s){c(".no-connection-item","#list-wrapper").each(function(t,e){var i=c(e).data("uuid"),i=s[i];void 0!==i&&c(this.templates.listItem(i)).insertBefore(e),d.removeListItem({target:c(e)})}.bind(this))},d.droppedOcConnection=function(){this.triggerMessage(c("#main-message-wrapper"),"Currently having problem connecting to OpenContent","warning oc-warning",!1)},d.setupActiveCheck=function(){c(document).on("mousedown",function(){d.lastClick=(new Date).getTime()})},d.getUrlParameterByName=function(t,e){t=t.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null},c(document).ready(function(){var t;d.lastClick=(new Date).getTime(),d.setupOcConnectionCheck(),d.setupActiveCheck(),c("body").css("overflow","initial"),d.settings=JSON.parse(eb_settings.list_settings),d.setupListeners(),d.numberOfItemToSave=""!==d.settings.number_of_items_to_save?d.settings.number_of_items_to_save:20,0<document.URL.indexOf("source=np")&&c("html").addClass("newspilot"),0<document.URL.indexOf("listid=")&&(void 0!==(t=document.URL.match(/(.+)listid\=([^\&]+)/i)[2])&&c(".list-selector").val(t).trigger("change")),d.listarea=c(".list-area"),Date.prototype.getMonthText=function(){return["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][this.getMonth()]},String.prototype.format=function(i){return this.toString().replace(/{{([0-9]+)}}/g,function(t,e){return i[e-1]})}})}(jQuery);